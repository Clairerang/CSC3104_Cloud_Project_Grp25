services:
  notification:
    # Use an env file for sensitive client config (do NOT commit .env)
    env_file:
      - config/secrets/.env
    volumes:
      # Mount local Firebase service account JSON into the container if present
      - ./config/secrets/firebase-sa.json:/app/config/secrets/firebase-sa.json:ro
      - ./shared/testing-ui:/app/testing-notification:ro
    environment:
      # Path the app expects for the service account JSON inside the container
      FIREBASE_SERVICE_ACCOUNT_PATH: /app/config/secrets/firebase-sa.json
    ports:
      - "50051:50051"

  push-notification:
    env_file:
      - config/secrets/.env
    volumes:
      - ./config/secrets/firebase-sa.json:/app/config/secrets/firebase-sa.json:ro
    environment:
      FIREBASE_SERVICE_ACCOUNT_PATH: /app/config/secrets/firebase-sa.json
      FCM_FALLBACK_V1: 'true'

  email:
    env_file:
      - config/secrets/.env
    environment:
      - MQTT_BROKER=hivemq
      - MQTT_PORT=1883
    ports:
      - "4003:4003"

  sms:
    env_file:
      - config/secrets/.env
    environment:
      - MQTT_BROKER=hivemq
      - MQTT_PORT=1883
      - METRICS_PORT=4004
    ports:
      - "4004:4004"
